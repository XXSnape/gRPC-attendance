syntax = "proto3";

package lessonService;

import "lesson.proto";

service LessonService {
  rpc GetLessons (LessonsRequest) returns (LessonsResponse) {}
  rpc GetLessonsForMonth (LessonsForMonthRequest) returns (LessonsForMonthResponse) {}
  rpc GetLessonDetails (LessonDetailsRequest) returns (LessonDetailsResponse) {}
  rpc SetStudentAttendance (stream StudentAttendanceRequest) returns (stream StudentAttendanceResponse) {}
  rpc GrantPrefectAttendancePermissions (GrantPrefectAttendancePermissionsRequest) returns (OkResponse) {}
  rpc GetLessonQRCodeData (LessonDetailsRequest) returns (LessonQRCodeResponse) {}
  rpc SelfApproveLessonAttendance (SelfApproveLessonAttendanceRequest) returns (OkResponse) {}
}

message SelfApproveLessonAttendanceRequest {
  string token = 1;
}

message LessonQRCodeResponse {
  string qr_url = 1;
  string token = 2;
  lesson.TotalAttendance total_attendance = 3;
  string expires_at = 4;
}

message GrantPrefectAttendancePermissionsRequest {
  string schedule_id = 1;
  optional int32 number_of_minutes_of_access = 2;
  optional string group_id = 3;
}

message OkResponse {
  bool ok = 1;
}

message StudentAttendanceRequest {
  string student_id = 1;
  lesson.Attendance attendance = 3;
}

message StudentAttendanceResponse {
  string student_id = 1;
  lesson.Attendance attendance = 2;
}


message LessonsRequest {
  string date = 1;
}

message LessonsResponse {
  repeated lesson.Schedule lessons = 1;
}

message LessonDetailsRequest {
  string schedule_id = 1;
}

message LessonsForMonthRequest {
  int32 month = 1;
  int32 year = 2;
}

message LessonsForMonthResponse {
  repeated string dates = 1;
}

message LessonDetailsResponse {
  lesson.Schedule schedule_data = 1;
  repeated lesson.GroupLesson groups = 2;
}